<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VoteHive ‚Äì Where Ideas Compete</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />

  <!-- Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <style>
    html.vh-dark body { background-color:#0f172a; color:#e5e7eb; }
    .vh-card { background:#fff; transition:box-shadow .2s ease, transform .06s ease; }
    html.vh-dark .vh-card { background:#111827; border-color:#1f2937; }
    .vh-card:hover { box-shadow:0 10px 30px rgba(2,6,23,.08); }
    .tag { display:inline-block; padding:6px 12px; border-radius:9999px; background:#f3f4f6; margin:4px; font-size:12px; }
    html.vh-dark .tag { background:#1f2937; }
    .menu-enter { max-height:0; overflow:hidden; transition:max-height .25s ease; }
    .menu-enter.open { max-height:420px; }
    @media (max-width: 767px){ .vh-quickbar { position: sticky; bottom: 0; z-index: 30; } }
  </style>

  <script src="theme.js"></script>
  <script src="auth.js" defer></script>
  <script src="streak.js" defer></script>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- Role-aware Header will render here -->
  <div id="vh-header"></div>
  <script src="header.js"></script>

  <!-- Hero -->
  <section class="bg-gradient-to-r from-indigo-700 to-purple-700 text-white">
    <div class="max-w-7xl mx-auto px-4 py-12 md:py-16">
      <div class="max-w-2xl">
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">Where Ideas Compete</h1>
        <p class="mt-3 md:mt-4 text-base md:text-lg opacity-90">Create, vote, and discover the most influential ideas across industries.</p>
        <div class="mt-5 flex flex-wrap gap-3">
          <a href="create.html" class="bg-white text-indigo-700 px-5 py-3 rounded font-semibold text-sm hover:bg-gray-100">Apply to Create</a>
          <a href="browse.html" class="border border-white px-5 py-3 rounded font-semibold text-sm hover:bg-white hover:text-purple-700">Browse Polls</a>
          <a href="leaderboard.html" class="border border-white px-5 py-3 rounded font-semibold text-sm hover:bg-white hover:text-purple-700">Leaderboard</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Trending -->
  <section class="max-w-7xl mx-auto px-4 py-10 md:py-14">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl md:text-2xl font-bold">Trending Now</h2>
      <div class="flex items-center gap-2">
        <label class="text-sm text-gray-600">Sort</label>
        <select id="sort" class="border rounded px-2 py-1 text-sm">
          <option value="trending" selected>üî• Trending score</option>
          <option value="closing">‚è≥ Closing soon</option>
          <option value="newest">üÜï Newest</option>
          <option value="votes">üìä Most votes</option>
        </select>
      </div>
    </div>
    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
  </section>

  <!-- Trending tags -->
  <section class="max-w-7xl mx-auto px-4 pb-24 md:pb-16">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-semibold">Trending Tags</h3>
      <a href="browse.html" class="text-sm text-indigo-600 hover:underline">See all ‚Üí</a>
    </div>
    <div id="tags" class="flex flex-wrap"></div>
  </section>

  <!-- Mobile Quick Actions -->
  <div class="vh-quickbar md:hidden border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 py-2 flex justify-between">
      <a href="browse.html" class="flex-1 text-center py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800">Browse</a>
      <a href="feed.html" class="flex-1 text-center py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800">Feed</a>
      <a href="create.html" class="flex-1 text-center py-2 rounded bg-indigo-600 text-white mx-2">Create</a>
      <a href="leaderboard.html" class="flex-1 text-center py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-800">Top</a>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-indigo-700 to-purple-700 text-white">
    <div class="max-w-7xl mx-auto px-4 py-8 md:py-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4 text-sm">
      <span>¬© 2025 VoteHive</span>
      <div class="flex gap-6">
        <a href="#" class="hover:underline">About</a>
        <a href="#" class="hover:underline">Contact</a>
      </div>
    </div>
  </footer>

  <script>
    // Trending logic (unchanged)
    const grid = document.getElementById('grid');
    const sortEl = document.getElementById('sort');
    const tagsEl = document.getElementById('tags');

    const getPolls = () => { try { return JSON.parse(localStorage.getItem('customPolls')||'{}'); } catch { return {}; } };
    const getVotes = () => { try { return JSON.parse(localStorage.getItem('pollVotes')||'{}'); } catch { return {}; } };

    function votesFor(id){ const v = getVotes()[id] || {}; return Object.values(v).reduce((a,b)=>a+b,0); }
    function scoreFor(id, p){
      const total = votesFor(id);
      const hoursLeft = Math.max(0, (new Date(p.endTime) - new Date())/36e5);
      const recency = 1/(1+hoursLeft);
      const freshness = Math.min(1, (Date.now()-new Date(p.createdAt||Date.now()))/86400000 < 2 ? 1 : 0.6);
      return total*0.8 + recency*10 + freshness*2;
    }
    function list(){ return Object.entries(getPolls()).filter(([id,p])=>p && !p.hidden); }

    function render(){
      const mode = sortEl.value;
      let rows = list();

      if (mode === 'trending') rows.sort((a,b)=> scoreFor(b[0],b[1]) - scoreFor(a[0],a[1]));
      if (mode === 'closing')  rows.sort((a,b)=> new Date(a[1].endTime) - new Date(b[1].endTime));
      if (mode === 'newest')   rows.sort((a,b)=> new Date(b[1].createdAt||0) - new Date(a[1].createdAt||0));
      if (mode === 'votes')    rows.sort((a,b)=> votesFor(b[0]) - votesFor(a[0]));

      grid.innerHTML = rows.slice(0,6).map(([id,p])=>{
        const end = new Date(p.endTime);
        const closed = Date.now() > end.getTime();
        const badge = closed?'bg-red-100 text-red-700':'bg-green-100 text-green-700';
        const v = votesFor(id);
        const trending = scoreFor(id,p) > 10 && !closed;

        return `
          <article class="vh-card border border-gray-100 dark:border-gray-800 shadow rounded p-4 flex flex-col">
            <div class="flex items-center gap-2 text-xs md:text-sm mb-2">
              <span class="px-2 py-1 rounded-full ${badge}">${closed?'Closed':'Open'}</span>
              <span class="text-gray-500">${p.category || 'General'}</span>
              ${p.featured ? '<span class="px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-700">Featured</span>' : ''}
              ${trending ? '<span class="px-2 py-0.5 rounded-full text-xs bg-orange-100 text-orange-700">üî• Trending</span>' : ''}
            </div>
            <h3 class="font-semibold text-base md:text-lg leading-snug mb-2">${p.title}</h3>
            <div class="text-xs text-gray-500 flex flex-wrap gap-x-3 gap-y-1 mb-4">
              <span>Votes: <strong>${v}</strong></span>
              <span>Ends: ${isNaN(end)?'N/A':end.toLocaleString()}</span>
            </div>
            <a href="poll.html?id=${encodeURIComponent(id)}" class="mt-auto inline-block text-center bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm">Open</a>
          </article>`;
      }).join('');

      renderTags(rows.map(r=>r[1]));
    }

    function renderTags(polls){
      const stop = new Set(['the','is','a','an','to','of','and','in','on','for','with','by','or','be','are','will','do','does','should','we','you','your','our']);
      const counts = {};
      polls.forEach(p=>{
        (p.title||'').toLowerCase().split(/[^a-z0-9]+/).filter(w=>w && !stop.has(w) && w.length>2).forEach(w=>{
          counts[w] = (counts[w]||0)+1;
        });
      });
      const tags = Object.entries(counts).sort((a,b)=> b[1]-a[1]).slice(0,14);
      tagsEl.innerHTML = tags.length
        ? tags.map(([w,c])=>`<a class="tag hover:bg-indigo-50 hover:text-indigo-700 dark:hover:bg-indigo-800" href="browse.html?tag=${encodeURIComponent(w)}">#${w}</a>`).join('')
        : '<div class="text-sm text-gray-600">No tags yet.</div>';
    }

    sortEl.addEventListener('change', render);
    render();
  </script>
</body>
</html>